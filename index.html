<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychology Paper Alert - Manuscript Alert</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .papers-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            margin-right: 10px;
        }

        .btn-danger {
            background: #ff4757;
            color: white;
        }

        .alert-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .alert-item .keywords {
            font-weight: 600;
            color: #333;
        }

        .alert-item .actions {
            display: flex;
            gap: 10px;
        }

        .paper-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s;
        }

        .paper-card:hover {
            transform: translateX(5px);
        }

        .paper-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .paper-card .authors {
            color: #666;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .paper-card .journal {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .paper-card .date {
            color: #999;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .paper-card .abstract {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 10px;
            font-style: italic;
        }

        .paper-card a {
            color: #0077b5;
            text-decoration: none;
            font-weight: 600;
        }

        .paper-card a:hover {
            text-decoration: underline;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .stats {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            flex: 1;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.1em;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tag {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š Psychology Paper Alert</h1>
            <p>ì‹¬ë¦¬í•™ ë…¼ë¬¸ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•˜ê³  ì•Œë¦¼ì„ ë°›ìœ¼ì„¸ìš”</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3 id="alertCount">0</h3>
                <p>í™œì„± ì•Œë¦¼</p>
            </div>
            <div class="stat-card">
                <h3 id="paperCount">0</h3>
                <p>ì €ì¥ëœ ë…¼ë¬¸</p>
            </div>
        </div>

        <div class="main-content">
            <div class="search-section">
                <h2 style="margin-bottom: 20px; color: #333;">ì•Œë¦¼ ì„¤ì •</h2>
                
                <form id="alertForm">
                    <div class="form-group">
                        <label for="keywords">í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„) *</label>
                        <input type="text" id="keywords" placeholder="ì˜ˆ: depression, anxiety, therapy" required>
                        <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">
                            ê´€ì‹¬ ìˆëŠ” ì‹¬ë¦¬í•™ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”
                        </small>
                    </div>
                    <button type="submit" class="btn btn-primary">ì•Œë¦¼ ì¶”ê°€</button>
                </form>

                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px; color: #333;">í™œì„± ì•Œë¦¼</h3>
                    <div id="alertsList">
                        <div class="empty-state">
                            <p>ì„¤ì •ëœ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="papers-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #333;">ë°œê²¬ëœ ë…¼ë¬¸</h2>
                    <button class="btn btn-secondary" onclick="searchPapers()">ìƒˆë¡œê³ ì¹¨</button>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.3em;">ğŸ”¥ ì¸ê¸° ë…¼ë¬¸ (ì¸ìš© 10íšŒ ì´ìƒ, ì¸ìš© ìˆ˜ ë†’ì€ ìˆœ)</h3>
                    <div id="popularPapersList">
                        <div class="empty-state">
                            <p>ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ë ¤ë©´ ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.3em;">ğŸ†• ìµœì‹  ë…¼ë¬¸</h3>
                    <div id="recentPapersList">
                        <div class="empty-state">
                            <p>ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ë ¤ë©´ ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë°ì´í„° ì €ì¥ì†Œ
        let alerts = JSON.parse(localStorage.getItem('paperAlerts')) || [];
        let savedPapers = JSON.parse(localStorage.getItem('savedPapers')) || [];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        function loadData() {
            displayAlerts();
            updateStats();
            if (alerts.length > 0) {
                searchPapers();
            }
        }

        // ì•Œë¦¼ ëª©ë¡ í‘œì‹œ
        function displayAlerts() {
            const alertsList = document.getElementById('alertsList');
            
            if (alerts.length === 0) {
                alertsList.innerHTML = `
                    <div class="empty-state">
                        <p>ì„¤ì •ëœ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            alertsList.innerHTML = alerts.map((alert, index) => `
                <div class="alert-item">
                    <div>
                        <div class="keywords">${alert.keywords.map(k => `<span class="tag">${escapeHtml(k)}</span>`).join('')}</div>
                        <small style="color: #666;">${alert.createdAt ? new Date(alert.createdAt).toLocaleDateString('ko-KR') : ''}</small>
                    </div>
                    <div class="actions">
                        <button class="btn btn-danger" onclick="deleteAlert(${index})">ì‚­ì œ</button>
                    </div>
                </div>
            `).join('');
        }

        // ì•Œë¦¼ ì¶”ê°€
        document.getElementById('alertForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const keywordsInput = document.getElementById('keywords').value.trim();
            if (!keywordsInput) {
                alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const keywords = keywordsInput.split(',').map(k => k.trim()).filter(k => k);
            
            const newAlert = {
                id: Date.now().toString(),
                keywords: keywords,
                createdAt: new Date().toISOString()
            };

            alerts.push(newAlert);
            localStorage.setItem('paperAlerts', JSON.stringify(alerts));
            
            document.getElementById('alertForm').reset();
            displayAlerts();
            updateStats();
            searchPapers();
        });

        // ì•Œë¦¼ ì‚­ì œ
        function deleteAlert(index) {
            if (confirm('ì´ ì•Œë¦¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                alerts.splice(index, 1);
                localStorage.setItem('paperAlerts', JSON.stringify(alerts));
                displayAlerts();
                updateStats();
                if (alerts.length === 0) {
                    document.getElementById('popularPapersList').innerHTML = `
                        <div class="empty-state">
                            <p>ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ë ¤ë©´ ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
                        </div>
                    `;
                    document.getElementById('recentPapersList').innerHTML = `
                        <div class="empty-state">
                            <p>ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ë ¤ë©´ ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
                        </div>
                    `;
                }
            }
        }

        // ë…¼ë¬¸ ê²€ìƒ‰
        async function searchPapers() {
            if (alerts.length === 0) {
                return;
            }

            const popularPapersList = document.getElementById('popularPapersList');
            const recentPapersList = document.getElementById('recentPapersList');
            popularPapersList.innerHTML = '<div class="loading"><div class="spinner"></div>ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ëŠ” ì¤‘</div>';
            recentPapersList.innerHTML = '';

            try {
                // ëª¨ë“  ì•Œë¦¼ì˜ í‚¤ì›Œë“œë¥¼ í•©ì³ì„œ ê²€ìƒ‰
                const allKeywords = [...new Set(alerts.flatMap(a => a.keywords))];
                const searchQuery = allKeywords.join(' OR ');

                // ìµœê·¼ 2ë…„ ë‚´ ë…¼ë¬¸ë§Œ ê²€ìƒ‰
                const twoYearsAgo = new Date();
                twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
                const yearFrom = twoYearsAgo.getFullYear();
                const today = new Date();
                const yearTo = today.getFullYear();

                // PubMed API ì‚¬ìš© - ì‹¤ì œ ë°œí–‰ëœ ë…¼ë¬¸ë§Œ (ë” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë°ì´í„°)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                
                // PubMed API: ìµœê·¼ 2ë…„, ì‹¬ë¦¬í•™ ê´€ë ¨, ì‹¤ì œ ë°œí–‰ëœ ë…¼ë¬¸ë§Œ
                const pubmedQuery = `${searchQuery} AND (${yearFrom}[PDAT] : ${yearTo}[PDAT]) AND psychology[MeSH Terms]`;
                const response = await fetch(
                    `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(pubmedQuery)}&retmax=15&retmode=json&sort=pub_date`,
                    {
                        headers: {
                            'Accept': 'application/json'
                        },
                        signal: controller.signal
                    }
                );
                
                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
                }

                const searchData = await response.json();
                const pmids = searchData.esearchresult?.idlist || [];

                if (pmids.length === 0) {
                    popularPapersList.innerHTML = `
                        <div class="empty-state">
                            <p>ê²€ìƒ‰ëœ ë…¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p style="margin-top: 10px; font-size: 0.9em;">ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                        </div>
                    `;
                    recentPapersList.innerHTML = '';
                    return;
                }

                // ë…¼ë¬¸ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const detailResponse = await fetch(
                    `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed&id=${pmids.join(',')}&retmode=json`,
                    {
                        signal: controller.signal
                    }
                );

                if (!detailResponse.ok) {
                    throw new Error('ìƒì„¸ ì •ë³´ ìš”ì²­ ì‹¤íŒ¨');
                }

                const detailData = await detailResponse.json();
                let papers = Object.values(detailData.result || {}).filter(p => p.uid !== '');

                // Semantic Scholar APIë¡œ ì¶”ê°€ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ìš”ì•½, ì¸ìš© ë“±)
                // PubMed ì œëª©ìœ¼ë¡œ Semantic Scholar ê²€ìƒ‰
                const semanticPromises = papers.slice(0, 10).map(async (paper) => {
                    try {
                        const title = paper.title || '';
                        if (!title) return paper;
                        
                        // Semantic Scholar API (ë¬´ë£Œ, API í‚¤ ë¶ˆí•„ìš”)
                        const semanticResponse = await fetch(
                            `https://api.semanticscholar.org/graph/v1/paper/search?query=${encodeURIComponent(title)}&limit=1&fields=abstract,citationCount,year`,
                            {
                                headers: {
                                    'Accept': 'application/json'
                                },
                                signal: controller.signal
                            }
                        );
                        
                        if (semanticResponse.ok) {
                            const semanticData = await semanticResponse.json();
                            if (semanticData.data && semanticData.data.length > 0) {
                                const semanticPaper = semanticData.data[0];
                                // Semantic Scholar ì •ë³´ ë³‘í•©
                                paper.abstract = semanticPaper.abstract || '';
                                paper.citationCount = semanticPaper.citationCount || 0;
                                if (semanticPaper.year && !paper.pubdate) {
                                    paper.pubdate = semanticPaper.year.toString();
                                }
                            }
                        }
                    } catch (e) {
                        // Semantic Scholar ì‹¤íŒ¨í•´ë„ PubMed ë°ì´í„°ëŠ” ì‚¬ìš©
                        console.log('Semantic Scholar API ì˜¤ë¥˜:', e);
                    }
                    return paper;
                });

                // ëª¨ë“  Semantic Scholar ìš”ì²­ ì™„ë£Œ ëŒ€ê¸°
                papers = await Promise.all(semanticPromises);

                // ë…¼ë¬¸ ì •ë ¬ ë° ë¶„ë¥˜
                // ì¸ê¸° ë…¼ë¬¸: ì¸ìš© ìˆ˜ê°€ 10íšŒ ì´ìƒì¸ ë…¼ë¬¸ë§Œ (ê³µì‹ ë ¥ ìˆëŠ” ë…¼ë¬¸)
                const papersWithCitations = papers.filter(p => p.citationCount && p.citationCount >= 10);
                const popularPapers = [...papersWithCitations]
                    .sort((a, b) => (b.citationCount || 0) - (a.citationCount || 0))
                    .slice(0, 10);
                
                // ìµœì‹  ë…¼ë¬¸ ì •ë ¬ (ë‚ ì§œ ê¸°ì¤€)
                const recentPapers = [...papers].sort((a, b) => {
                    const dateA = a.pubdate || a.sortpubdate || a.epubdate || '';
                    const dateB = b.pubdate || b.sortpubdate || b.epubdate || '';
                    if (!dateA && !dateB) return 0;
                    if (!dateA) return 1;
                    if (!dateB) return -1;
                    return dateB.localeCompare(dateA);
                }).slice(0, 10);

                // ë…¼ë¬¸ ì¹´ë“œ ìƒì„± í•¨ìˆ˜
                const createPaperCard = (paper) => {
                    const title = paper.title || 'ì œëª© ì—†ìŒ';
                    const authors = paper.authors ? paper.authors.map(a => a.name || '').filter(n => n).join(', ') : 'ì €ì ì •ë³´ ì—†ìŒ';
                    const journal = paper.source || '';
                    
                    // ë‚ ì§œ ì •ë³´ ì¶”ì¶œ (ì—¬ëŸ¬ í•„ë“œ í™•ì¸)
                    let pubDate = paper.pubdate || paper.sortpubdate || paper.epubdate || '';
                    let date = 'ë‚ ì§œ ì •ë³´ ì—†ìŒ';
                    let year = '';
                    
                    if (pubDate) {
                        // PubMed ë‚ ì§œ í˜•ì‹: "2024 Jan 15" ë˜ëŠ” "2024/01/15" ë˜ëŠ” "2024"
                        if (pubDate.includes(' ')) {
                            // "2024 Jan 15" í˜•ì‹
                            const parts = pubDate.split(' ');
                            year = parts[0] || '';
                            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                            const month = parts[1] ? (monthNames.indexOf(parts[1]) + 1) : '';
                            const day = parts[2] || '';
                            if (year && month && day) {
                                date = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                            } else if (year && month) {
                                date = `${year}-${String(month).padStart(2, '0')}`;
                            } else if (year) {
                                date = year;
                            }
                        } else if (pubDate.includes('/')) {
                            // "2024/01/15" í˜•ì‹
                            const parts = pubDate.split('/');
                            year = parts[0] || '';
                            date = pubDate;
                        } else if (pubDate.length === 4) {
                            // "2024" í˜•ì‹
                            year = pubDate;
                            date = year;
                        } else {
                            date = pubDate;
                            year = pubDate.substring(0, 4);
                        }
                    }
                    
                    const pmid = paper.uid || '';
                    const pmidUrl = pmid ? `https://pubmed.ncbi.nlm.nih.gov/${pmid}/` : '';
                    const abstract = paper.abstract || '';
                    const citationCount = paper.citationCount || 0;
                    
                    // ìµœì‹  ë…¼ë¬¸ í‘œì‹œ (1ë…„ ì´ë‚´)
                    let dateBadge = '';
                    if (year) {
                        const paperYear = parseInt(year);
                        const currentYear = new Date().getFullYear();
                        if (paperYear === currentYear || paperYear === currentYear - 1) {
                            dateBadge = '<span style="background: #4caf50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.75em; margin-left: 8px;">ìµœì‹ </span>';
                        }
                    }

                    return `
                        <div class="paper-card">
                            <h3>${escapeHtml(title)}${dateBadge}</h3>
                            <div class="authors">${escapeHtml(authors)}</div>
                            ${journal ? `<div class="journal">ğŸ“– ${escapeHtml(journal)}</div>` : ''}
                            <div class="date">ğŸ“… ${date}${citationCount > 0 ? ` | ì¸ìš©: ${citationCount}íšŒ` : ''}</div>
                            ${abstract ? `<div class="abstract" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e0e0e0;">${escapeHtml(abstract.substring(0, 200))}${abstract.length > 200 ? '...' : ''}</div>` : ''}
                            ${pmidUrl ? `<div style="margin-top: 10px;"><a href="${pmidUrl}" target="_blank">ë…¼ë¬¸ ë³´ê¸° (PubMed)</a></div>` : ''}
                        </div>
                    `;
                };

                // ì¸ê¸° ë…¼ë¬¸ ëª©ë¡ í‘œì‹œ (ì¸ìš© 10íšŒ ì´ìƒë§Œ)
                if (popularPapers.length > 0) {
                    popularPapersList.innerHTML = popularPapers.map(createPaperCard).join('');
                } else {
                    popularPapersList.innerHTML = `
                        <div class="empty-state">
                            <p>ì¸ìš© ìˆ˜ 10íšŒ ì´ìƒì¸ ì¸ê¸° ë…¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p style="margin-top: 10px; font-size: 0.9em;">ìµœì‹  ë…¼ë¬¸ ì„¹ì…˜ì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>
                        </div>
                    `;
                }

                // ìµœì‹  ë…¼ë¬¸ ëª©ë¡ í‘œì‹œ
                if (recentPapers.length > 0) {
                    recentPapersList.innerHTML = recentPapers.map(createPaperCard).join('');
                } else {
                    recentPapersList.innerHTML = `
                        <div class="empty-state">
                            <p>ìµœì‹  ë…¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    `;
                }

                // ì €ì¥ëœ ë…¼ë¬¸ ì—…ë°ì´íŠ¸
                savedPapers = papers.map(paper => {
                    const pubDate = paper.pubdate || paper.sortpubdate || paper.epubdate || '';
                    let formattedDate = '';
                    
                    if (pubDate) {
                        if (pubDate.includes(' ')) {
                            const parts = pubDate.split(' ');
                            const year = parts[0] || '';
                            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                            const month = parts[1] ? (monthNames.indexOf(parts[1]) + 1) : '';
                            const day = parts[2] || '';
                            if (year && month && day) {
                                formattedDate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                            } else if (year && month) {
                                formattedDate = `${year}-${String(month).padStart(2, '0')}`;
                            } else {
                                formattedDate = year || pubDate;
                            }
                        } else {
                            formattedDate = pubDate;
                        }
                    }
                    
                    return {
                        id: paper.uid || Date.now().toString(),
                        title: paper.title || '',
                        authors: paper.authors ? paper.authors.map(a => a.name || '').filter(n => n).join(', ') : '',
                        journal: paper.source || '',
                        date: formattedDate || pubDate || '',
                        doi: '',
                        pmid: paper.uid || '',
                        savedAt: new Date().toISOString()
                    };
                });
                localStorage.setItem('savedPapers', JSON.stringify(savedPapers));
                updateStats();

            } catch (error) {
                console.error('Error:', error);
                if (error.name === 'AbortError') {
                    papersList.innerHTML = `
                        <div class="empty-state">
                            <p>ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                            <p style="margin-top: 10px; font-size: 0.9em;">ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    `;
                } else {
                    papersList.innerHTML = `
                        <div class="empty-state">
                            <p>ë…¼ë¬¸ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                            <p style="margin-top: 10px; font-size: 0.9em;">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    `;
                }
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('alertCount').textContent = alerts.length;
            document.getElementById('paperCount').textContent = savedPapers.length;
        }

        // XSS ë°©ì§€
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ì´ˆê¸° ë¡œë“œ
        loadData();
    </script>
</body>
</html>

