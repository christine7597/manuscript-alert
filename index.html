<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychology Paper Alert - Manuscript Alert</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .papers-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            margin-right: 10px;
        }

        .btn-danger {
            background: #ff4757;
            color: white;
        }

        .alert-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .alert-item .keywords {
            font-weight: 600;
            color: #333;
        }

        .alert-item .actions {
            display: flex;
            gap: 10px;
        }

        .paper-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s;
        }

        .paper-card:hover {
            transform: translateX(5px);
        }

        .paper-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .paper-card .authors {
            color: #666;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .paper-card .journal {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .paper-card .date {
            color: #999;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .paper-card .abstract {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 10px;
            font-style: italic;
        }

        .paper-card a {
            color: #0077b5;
            text-decoration: none;
            font-weight: 600;
        }

        .paper-card a:hover {
            text-decoration: underline;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .stats {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            flex: 1;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .auto-update-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
            margin-left: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .last-update {
            font-size: 0.85em;
            color: #666;
            margin-top: 10px;
            text-align: center;
        }

        .new-paper-badge {
            background: #ff4757;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            margin-left: 8px;
            animation: pulse 1s infinite;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.1em;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .tag {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š Psychology Paper Alert</h1>
            <p>ì‹¬ë¦¬í•™ ë…¼ë¬¸ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•˜ê³  ì•Œë¦¼ì„ ë°›ìœ¼ì„¸ìš”</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3 id="alertCount">0</h3>
                <p>í™œì„± ì•Œë¦¼</p>
            </div>
            <div class="stat-card">
                <h3 id="paperCount">0</h3>
                <p>ì €ì¥ëœ ë…¼ë¬¸</p>
            </div>
        </div>

        <div class="main-content">
            <div class="search-section">
                <h2 style="margin-bottom: 20px; color: #333;">ì•Œë¦¼ ì„¤ì •</h2>
                
                <form id="alertForm">
                    <div class="form-group">
                        <label for="keywords">í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„) *</label>
                        <input type="text" id="keywords" placeholder="ì˜ˆ: depression, anxiety, therapy" required>
                        <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">
                            ê´€ì‹¬ ìˆëŠ” ì‹¬ë¦¬í•™ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”
                        </small>
                    </div>
                    <button type="submit" class="btn btn-primary">ì•Œë¦¼ ì¶”ê°€</button>
                </form>

                <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e0e0e0;">
                    <h3 style="margin-bottom: 15px; color: #333;">ì¸ìš© ìˆ˜ ê¸°ì¤€ ì•Œë¦¼</h3>
                    <form id="citationAlertForm">
                        <div class="form-group">
                            <label for="citationKeywords">í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„) *</label>
                            <input type="text" id="citationKeywords" placeholder="ì˜ˆ: depression, anxiety" required>
                        </div>
                        <div class="form-group">
                            <label for="minCitations">ìµœì†Œ ì¸ìš© ìˆ˜ *</label>
                            <input type="number" id="minCitations" placeholder="ì˜ˆ: 10" min="1" required>
                            <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">
                                ì´ ì¸ìš© ìˆ˜ ì´ìƒì¸ ë…¼ë¬¸ì´ ë‚˜ì˜¤ë©´ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤
                            </small>
                        </div>
                        <button type="submit" class="btn btn-primary">ì¸ìš© ìˆ˜ ì•Œë¦¼ ì¶”ê°€</button>
                    </form>
                </div>

                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px; color: #333;">í™œì„± ì•Œë¦¼</h3>
                    <div id="alertsList">
                        <div class="empty-state">
                            <p>ì„¤ì •ëœ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="papers-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #333;">
                        ë°œê²¬ëœ ë…¼ë¬¸ 
                        <span class="auto-update-indicator" id="updateIndicator"></span>
                        <span style="font-size: 0.7em; color: #666; font-weight: normal;">(30ë¶„ë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸)</span>
                    </h2>
                    <button class="btn btn-secondary" onclick="searchPapers()">ì§€ê¸ˆ ê²€ìƒ‰</button>
                </div>
                <div class="last-update" id="lastUpdate">
                    ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.3em;">ğŸ”¥ ì¸ê¸° ë…¼ë¬¸ (ì§€ë‚œ 5ë…„ ë‚´, ì¸ìš© ìˆ˜ ë†’ì€ ìˆœ)</h3>
                    <small style="color: #666; display: block; margin-bottom: 10px;">ì¸ìš© ìˆ˜ ì •ë³´ê°€ ìˆëŠ” ë…¼ë¬¸ ì¤‘ ì¸ê¸° ë…¼ë¬¸ì„ í‘œì‹œí•©ë‹ˆë‹¤.</small>
                    <div id="popularPapersList">
                        <div class="empty-state">
                            <p>ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ë ¤ë©´ ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.3em;">ğŸ†• ìµœì‹  ë…¼ë¬¸</h3>
                    <div id="recentPapersList">
                        <div class="empty-state">
                            <p>ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ë ¤ë©´ ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë°ì´í„° ì €ì¥ì†Œ
        let alerts = JSON.parse(localStorage.getItem('paperAlerts')) || [];
        let savedPapers = JSON.parse(localStorage.getItem('savedPapers')) || [];
        let lastSearchTime = localStorage.getItem('lastSearchTime') || null;
        let lastPaperIds = JSON.parse(localStorage.getItem('lastPaperIds')) || [];
        let autoUpdateInterval = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        function loadData() {
            displayAlerts();
            updateStats();
            updateLastSearchTime();
            if (alerts.length > 0) {
                searchPapers();
            }
            // ìë™ ì—…ë°ì´íŠ¸ ì‹œì‘
            startAutoUpdate();
        }

        // ë§ˆì§€ë§‰ ê²€ìƒ‰ ì‹œê°„ í‘œì‹œ
        function updateLastSearchTime() {
            const lastUpdateEl = document.getElementById('lastUpdate');
            if (lastSearchTime) {
                const lastDate = new Date(lastSearchTime);
                const now = new Date();
                const diffMinutes = Math.floor((now - lastDate) / (1000 * 60));
                
                if (diffMinutes < 1) {
                    lastUpdateEl.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ë°©ê¸ˆ ì „`;
                } else if (diffMinutes < 60) {
                    lastUpdateEl.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${diffMinutes}ë¶„ ì „`;
                } else {
                    const diffHours = Math.floor(diffMinutes / 60);
                    lastUpdateEl.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${diffHours}ì‹œê°„ ì „`;
                }
            } else {
                lastUpdateEl.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ì•„ì§ ê²€ìƒ‰í•˜ì§€ ì•ŠìŒ`;
            }
        }

        // ìë™ ì—…ë°ì´íŠ¸ ì‹œì‘
        function startAutoUpdate() {
            if (alerts.length === 0) {
                return; // ì•Œë¦¼ì´ ì—†ìœ¼ë©´ ìë™ ì—…ë°ì´íŠ¸ ì•ˆ í•¨
            }

            // ê¸°ì¡´ ì¸í„°ë²Œ ì œê±°
            if (autoUpdateInterval) {
                clearInterval(autoUpdateInterval);
            }

            // 30ë¶„ë§ˆë‹¤ ìë™ ê²€ìƒ‰
            autoUpdateInterval = setInterval(() => {
                if (alerts.length > 0) {
                    console.log('ìë™ ê²€ìƒ‰ ì‹¤í–‰...');
                    searchPapers(true); // true = ìë™ ê²€ìƒ‰ì„ì„ í‘œì‹œ
                }
            }, 30 * 60 * 1000); // 30ë¶„ = 30 * 60 * 1000ms
        }

        // ì•Œë¦¼ ëª©ë¡ í‘œì‹œ
        function displayAlerts() {
            const alertsList = document.getElementById('alertsList');
            
            if (alerts.length === 0) {
                alertsList.innerHTML = `
                    <div class="empty-state">
                        <p>ì„¤ì •ëœ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            alertsList.innerHTML = alerts.map((alert, index) => `
                <div class="alert-item">
                    <div>
                        <div class="keywords">${alert.keywords.map(k => `<span class="tag">${escapeHtml(k)}</span>`).join('')}</div>
                        ${alert.minCitations && alert.minCitations > 0 ? `<div style="margin-top: 5px; color: #667eea; font-weight: 600;">ğŸ“Š ì¸ìš© ìˆ˜ ì•Œë¦¼: ${alert.minCitations}íšŒ ì´ìƒ</div>` : ''}
                        <small style="color: #666;">${alert.createdAt ? new Date(alert.createdAt).toLocaleDateString('ko-KR') : ''}</small>
                    </div>
                    <div class="actions">
                        <button class="btn btn-danger" onclick="deleteAlert(${index})">ì‚­ì œ</button>
                    </div>
                </div>
            `).join('');
        }

        // ì•Œë¦¼ ì¶”ê°€
        document.getElementById('alertForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const keywordsInput = document.getElementById('keywords').value.trim();
            if (!keywordsInput) {
                alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const keywords = keywordsInput.split(',').map(k => k.trim()).filter(k => k);
            
            const newAlert = {
                id: Date.now().toString(),
                keywords: keywords,
                minCitations: 0, // ì¼ë°˜ ì•Œë¦¼ì€ ì¸ìš© ìˆ˜ ê¸°ì¤€ ì—†ìŒ
                createdAt: new Date().toISOString()
            };

            alerts.push(newAlert);
            localStorage.setItem('paperAlerts', JSON.stringify(alerts));
            
            document.getElementById('alertForm').reset();
            displayAlerts();
            updateStats();
            startAutoUpdate(); // ìë™ ì—…ë°ì´íŠ¸ ì¬ì‹œì‘
            searchPapers();
        });

        // ì¸ìš© ìˆ˜ ê¸°ì¤€ ì•Œë¦¼ ì¶”ê°€
        document.getElementById('citationAlertForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const keywordsInput = document.getElementById('citationKeywords').value.trim();
            const minCitationsInput = document.getElementById('minCitations').value.trim();
            
            if (!keywordsInput) {
                alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const minCitations = parseInt(minCitationsInput);
            if (!minCitations || minCitations < 1) {
                alert('ìµœì†Œ ì¸ìš© ìˆ˜ë¥¼ 1 ì´ìƒìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const keywords = keywordsInput.split(',').map(k => k.trim()).filter(k => k);
            
            const newAlert = {
                id: Date.now().toString(),
                keywords: keywords,
                minCitations: minCitations,
                isCitationAlert: true, // ì¸ìš© ìˆ˜ ì•Œë¦¼ êµ¬ë¶„
                createdAt: new Date().toISOString()
            };

            alerts.push(newAlert);
            localStorage.setItem('paperAlerts', JSON.stringify(alerts));
            
            document.getElementById('citationAlertForm').reset();
            displayAlerts();
            updateStats();
            startAutoUpdate(); // ìë™ ì—…ë°ì´íŠ¸ ì¬ì‹œì‘
            searchPapers();
        });

        // ì•Œë¦¼ ì‚­ì œ
        function deleteAlert(index) {
            if (confirm('ì´ ì•Œë¦¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                alerts.splice(index, 1);
                localStorage.setItem('paperAlerts', JSON.stringify(alerts));
                displayAlerts();
                updateStats();
                if (alerts.length === 0) {
                    document.getElementById('popularPapersList').innerHTML = `
                        <div class="empty-state">
                            <p>ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ë ¤ë©´ ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
                        </div>
                    `;
                    document.getElementById('recentPapersList').innerHTML = `
                        <div class="empty-state">
                            <p>ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ë ¤ë©´ ì•Œë¦¼ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
                        </div>
                    `;
                }
            }
        }

        // ë…¼ë¬¸ ê²€ìƒ‰
        async function searchPapers(isAutoUpdate = false) {
            if (alerts.length === 0) {
                return;
            }

            const popularPapersList = document.getElementById('popularPapersList');
            const recentPapersList = document.getElementById('recentPapersList');
            popularPapersList.innerHTML = '<div class="loading"><div class="spinner"></div>ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ëŠ” ì¤‘</div>';
            recentPapersList.innerHTML = '';

            try {
                // ëª¨ë“  ì•Œë¦¼ì˜ í‚¤ì›Œë“œë¥¼ í•©ì³ì„œ ê²€ìƒ‰
                const allKeywords = [...new Set(alerts.flatMap(a => a.keywords))];
                const searchQuery = allKeywords.join(' OR ');

                // ìµœê·¼ 2ë…„ ë‚´ ë…¼ë¬¸ë§Œ ê²€ìƒ‰
                const twoYearsAgo = new Date();
                twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
                const yearFrom = twoYearsAgo.getFullYear();
                const today = new Date();
                const yearTo = today.getFullYear() + 1; // ë¯¸ë˜ ë…„ë„ë„ í¬í•¨ (ì˜ˆì •ëœ ì¶œíŒì¼)

                // PubMed API ì‚¬ìš© - ì‹¤ì œ ë°œí–‰ëœ ë…¼ë¬¸ë§Œ (ë” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë°ì´í„°)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                
                // PubMed API: ìµœê·¼ 5ë…„, ì‹¬ë¦¬í•™ ê´€ë ¨, ì‹¤ì œ ë°œí–‰ëœ ë…¼ë¬¸ë§Œ
                // PDAT: Publication Date (ì‹¤ì œ ì¶œíŒì¼)
                // epubdate í•„í„°ëŠ” ë³„ë„ë¡œ ì²˜ë¦¬
                // ì¸ê¸° ë…¼ë¬¸ì„ ìœ„í•´ ë” ë„“ì€ ë²”ìœ„ì™€ ë” ë§ì€ ê²°ê³¼ ê²€ìƒ‰
                const fiveYearsAgo = new Date();
                fiveYearsAgo.setFullYear(fiveYearsAgo.getFullYear() - 5);
                const yearFrom5 = fiveYearsAgo.getFullYear();
                
                const pubmedQuery = `${searchQuery} AND (${yearFrom5}[PDAT] : ${yearTo}[PDAT]) AND psychology[MeSH Terms]`;
                const response = await fetch(
                    `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(pubmedQuery)}&retmax=100&retmode=json&sort=pub_date`,
                    {
                        headers: {
                            'Accept': 'application/json'
                        },
                        signal: controller.signal
                    }
                );
                
                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
                }

                const searchData = await response.json();
                const pmids = searchData.esearchresult?.idlist || [];

                if (pmids.length === 0) {
                    popularPapersList.innerHTML = `
                        <div class="empty-state">
                            <p>ê²€ìƒ‰ëœ ë…¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p style="margin-top: 10px; font-size: 0.9em;">ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                        </div>
                    `;
                    recentPapersList.innerHTML = '';
                    return;
                }

                // ë…¼ë¬¸ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const detailResponse = await fetch(
                    `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed&id=${pmids.join(',')}&retmode=json`,
                    {
                        signal: controller.signal
                    }
                );

                if (!detailResponse.ok) {
                    throw new Error('ìƒì„¸ ì •ë³´ ìš”ì²­ ì‹¤íŒ¨');
                }

                const detailData = await detailResponse.json();
                let papers = Object.values(detailData.result || {}).filter(p => p.uid !== '');

                // Semantic Scholar APIë¡œ ì¶”ê°€ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ìš”ì•½, ì¸ìš© ë“±)
                // PubMed PMIDë¥¼ ì‚¬ìš©í•´ì„œ ë” ì •í™•í•˜ê²Œ ê²€ìƒ‰
                // ì¸ê¸° ë…¼ë¬¸ì„ ìœ„í•´ ë” ë§ì€ ë…¼ë¬¸ì— ëŒ€í•´ ì‹œë„
                const semanticPromises = papers.slice(0, 50).map(async (paper) => {
                    try {
                        const pmid = paper.uid || '';
                        const title = paper.title || '';
                        if (!pmid && !title) return paper;
                        
                        let semanticPaper = null;
                        
                        // ë°©ë²• 1: PMIDë¡œ ì§ì ‘ ê²€ìƒ‰ (ê°€ì¥ ì •í™•)
                        if (pmid) {
                            try {
                                const pmidResponse = await fetch(
                                    `https://api.semanticscholar.org/graph/v1/paper/PMID:${pmid}?fields=abstract,citationCount,year,title`,
                                    {
                                        headers: {
                                            'Accept': 'application/json'
                                        },
                                        signal: controller.signal
                                    }
                                );
                                
                                if (pmidResponse.ok) {
                                    semanticPaper = await pmidResponse.json();
                                }
                            } catch (e) {
                                // PMID ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ ì œëª©ìœ¼ë¡œ ê²€ìƒ‰
                            }
                        }
                        
                        // ë°©ë²• 2: ì œëª©ìœ¼ë¡œ ê²€ìƒ‰ (PMID ì‹¤íŒ¨ ì‹œ)
                        if (!semanticPaper && title) {
                            try {
                                const titleResponse = await fetch(
                                    `https://api.semanticscholar.org/graph/v1/paper/search?query=${encodeURIComponent(title)}&limit=3&fields=abstract,citationCount,year,title`,
                                    {
                                        headers: {
                                            'Accept': 'application/json'
                                        },
                                        signal: controller.signal
                                    }
                                );
                                
                                if (titleResponse.ok) {
                                    const titleData = await titleResponse.json();
                                    if (titleData.data && titleData.data.length > 0) {
                                        // ì œëª©ì´ ê°€ì¥ ìœ ì‚¬í•œ ë…¼ë¬¸ ì°¾ê¸°
                                        const titleLower = title.toLowerCase();
                                        semanticPaper = titleData.data.find(p => 
                                            p.title && p.title.toLowerCase().includes(titleLower.substring(0, 20))
                                        ) || titleData.data[0];
                                    }
                                }
                            } catch (e) {
                                // ì œëª© ê²€ìƒ‰ë„ ì‹¤íŒ¨
                            }
                        }
                        
                        // Semantic Scholar ì •ë³´ ë³‘í•©
                        if (semanticPaper) {
                            paper.abstract = semanticPaper.abstract || paper.abstract || '';
                            paper.citationCount = semanticPaper.citationCount || paper.citationCount || 0;
                            if (semanticPaper.year && !paper.pubdate) {
                                paper.pubdate = semanticPaper.year.toString();
                            }
                        }
                    } catch (e) {
                        // Semantic Scholar ì‹¤íŒ¨í•´ë„ PubMed ë°ì´í„°ëŠ” ì‚¬ìš©
                        console.log('Semantic Scholar API ì˜¤ë¥˜:', e);
                    }
                    return paper;
                });

                // ëª¨ë“  Semantic Scholar ìš”ì²­ ì™„ë£Œ ëŒ€ê¸°
                papers = await Promise.all(semanticPromises);
                
                // í˜„ì¬ ë‚ ì§œ ê¸°ì¤€
                const currentDate = new Date();
                const currentYear = currentDate.getFullYear();
                const currentMonth = currentDate.getMonth() + 1; // 1-12
                const currentDay = currentDate.getDate();
                const fiveYearsAgo = currentYear - 5;
                const tenYearsAgo = currentYear - 10;
                
                // ë‚ ì§œ íŒŒì‹± í•¨ìˆ˜ (ë…¼ë¬¸ ë‚ ì§œë¥¼ Date ê°ì²´ë¡œ ë³€í™˜)
                const parsePaperDate = (dateStr) => {
                    if (!dateStr) return null;
                    
                    try {
                        // "2024 Jan 15" í˜•ì‹
                        if (dateStr.includes(' ')) {
                            const parts = dateStr.split(' ');
                            const year = parseInt(parts[0]);
                            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                            const month = parts[1] ? monthNames.indexOf(parts[1]) + 1 : 1;
                            const day = parts[2] ? parseInt(parts[2]) : 1;
                            return new Date(year, month - 1, day);
                        }
                        // "2024/01/15" í˜•ì‹
                        else if (dateStr.includes('/')) {
                            const parts = dateStr.split('/');
                            const year = parseInt(parts[0]);
                            const month = parseInt(parts[1]) || 1;
                            const day = parseInt(parts[2]) || 1;
                            return new Date(year, month - 1, day);
                        }
                        // "2024" í˜•ì‹ (ë…„ë„ë§Œ)
                        else if (dateStr.length === 4) {
                            const year = parseInt(dateStr);
                            return new Date(year, 0, 1); // 1ì›” 1ì¼ë¡œ ì„¤ì •
                        }
                    } catch (e) {
                        console.log('ë‚ ì§œ íŒŒì‹± ì˜¤ë¥˜:', dateStr, e);
                    }
                    return null;
                };
                
                // ë‚ ì§œ ì •ê·œí™”: epubdate(ì˜¨ë¼ì¸ ê³µê°œì¼)ë¥¼ ìš°ì„  ì‚¬ìš©
                // Epub ahead of print ë…¼ë¬¸ì€ pubdateê°€ ë¯¸ë˜ì¼ ìˆ˜ ìˆì§€ë§Œ, epubdateëŠ” ì‹¤ì œ ê³µê°œì¼
                papers = papers.map(paper => {
                    const pubDate = paper.pubdate || '';
                    const epubDate = paper.epubdate || '';
                    
                    // epubdateê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš© (ì‹¤ì œ ì˜¨ë¼ì¸ ê³µê°œì¼)
                    // pubdateëŠ” ì¸ì‡„ ì˜ˆì •ì¼ì¼ ìˆ˜ ìˆì–´ì„œ epubdateê°€ ë” ì •í™•í•¨
                    if (epubDate) {
                        paper.pubdate = epubDate; // í‘œì‹œìš© ë‚ ì§œë¡œ epubdate ì‚¬ìš©
                    }
                    // epubdateê°€ ì—†ìœ¼ë©´ pubdate ì‚¬ìš©
                    
                    return paper;
                });
                
                // ì¸ìš© ìˆ˜ ê¸°ì¤€ ì•Œë¦¼ ì²´í¬
                checkCitationAlerts(papers);
                
                // ë…¼ë¬¸ ì •ë ¬ ë° ë¶„ë¥˜
                // ì¸ê¸° ë…¼ë¬¸: ì§€ë‚œ 5ë…„ ë‚´ ë…¼ë¬¸ ì¤‘ ì¸ìš© ìˆ˜ê°€ ìˆëŠ” ê²ƒ (ì¸ìš© ìˆ˜ ë†’ì€ ìˆœ)
                const papersWithCitations = papers.filter(p => {
                    // ì¸ìš© ìˆ˜ê°€ ìˆì–´ì•¼ í•¨ (ìµœì†Œ 1íšŒ ì´ìƒ)
                    const citationCount = p.citationCount || 0;
                    if (citationCount < 1) return false;
                    
                    // ë‚ ì§œ ì¶”ì¶œ
                    const pubDate = p.pubdate || p.sortpubdate || p.epubdate || '';
                    if (!pubDate) return false;
                    
                    // ë…„ë„ ì¶”ì¶œ
                    let paperYear = null;
                    if (pubDate.includes(' ')) {
                        paperYear = parseInt(pubDate.split(' ')[0]);
                    } else if (pubDate.includes('/')) {
                        paperYear = parseInt(pubDate.split('/')[0]);
                    } else if (pubDate.length === 4) {
                        paperYear = parseInt(pubDate);
                    }
                    
                    // ì§€ë‚œ 5ë…„ ë‚´ ë…¼ë¬¸ë§Œ (ë¯¸ë˜ ë‚ ì§œë„ í¬í•¨ - Epub ahead of print í¬í•¨)
                    if (paperYear && paperYear >= fiveYearsAgo && paperYear <= currentYear + 1) {
                        // í˜„ì¬ ë…„ë„ + 1ë…„ê¹Œì§€ í¬í•¨ (ì˜ˆì •ëœ ì¶œíŒì¼ í¬í•¨)
                        return true;
                    }
                    return false;
                });
                
                // ë””ë²„ê¹…: ì¸ìš© ìˆ˜ ì •ë³´ í™•ì¸
                console.log('ì „ì²´ ë…¼ë¬¸ ìˆ˜:', papers.length);
                console.log('ì¸ìš© ìˆ˜ê°€ ìˆëŠ” ë…¼ë¬¸:', papers.filter(p => p.citationCount && p.citationCount > 0).length);
                console.log('ì¸ìš© ìˆ˜ ìƒ˜í”Œ:', papers.slice(0, 5).map(p => ({ title: p.title?.substring(0, 30), citations: p.citationCount })));
                
                // ì¸ìš© ìˆ˜ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬ (ì¸ìš© ìˆ˜ê°€ ë§ì€ ê²ƒ ìš°ì„ )
                let popularPapers = [...papersWithCitations]
                    .sort((a, b) => {
                        const citationA = a.citationCount || 0;
                        const citationB = b.citationCount || 0;
                        if (citationB !== citationA) {
                            return citationB - citationA; // ì¸ìš© ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ
                        }
                        // ì¸ìš© ìˆ˜ê°€ ê°™ìœ¼ë©´ ìµœì‹ ìˆœ
                        const dateA = a.pubdate || a.sortpubdate || a.epubdate || '';
                        const dateB = b.pubdate || b.sortpubdate || b.epubdate || '';
                        return dateB.localeCompare(dateA);
                    })
                    .slice(0, 10);
                
                // ì¸ìš© ìˆ˜ê°€ ìˆëŠ” ë…¼ë¬¸ì´ ì ìœ¼ë©´, ìµœì‹  ë…¼ë¬¸ ì¤‘ ì¼ë¶€ë¥¼ ì¸ê¸° ë…¼ë¬¸ìœ¼ë¡œ í‘œì‹œ
                if (popularPapers.length < 5) {
                    // ìµœì‹  ë…¼ë¬¸ ì¤‘ì—ì„œ ì¸ìš© ìˆ˜ê°€ ì—†ëŠ” ê²ƒë„ í¬í•¨í•˜ì—¬ ì¸ê¸° ë…¼ë¬¸ìœ¼ë¡œ í‘œì‹œ
                    const recentForPopular = [...papers]
                        .filter(p => {
                            const pubDate = p.pubdate || p.sortpubdate || p.epubdate || '';
                            if (!pubDate) return false;
                            
                            let paperYear = null;
                            if (pubDate.includes(' ')) {
                                paperYear = parseInt(pubDate.split(' ')[0]);
                            } else if (pubDate.includes('/')) {
                                paperYear = parseInt(pubDate.split('/')[0]);
                            } else if (pubDate.length === 4) {
                                paperYear = parseInt(pubDate);
                            }
                            
                            return paperYear && paperYear >= fiveYearsAgo && paperYear <= currentYear + 1;
                        })
                        .sort((a, b) => {
                            // ì¸ìš© ìˆ˜ê°€ ìˆìœ¼ë©´ ìš°ì„ , ì—†ìœ¼ë©´ ìµœì‹ ìˆœ
                            const citationA = a.citationCount || 0;
                            const citationB = b.citationCount || 0;
                            if (citationB !== citationA) {
                                return citationB - citationA;
                            }
                            const dateA = a.pubdate || a.sortpubdate || a.epubdate || '';
                            const dateB = b.pubdate || b.sortpubdate || b.epubdate || '';
                            return dateB.localeCompare(dateA);
                        })
                        .slice(0, 10);
                    
                    // ê¸°ì¡´ ì¸ê¸° ë…¼ë¬¸ê³¼ í•©ì¹˜ê¸° (ì¤‘ë³µ ì œê±°)
                    const existingIds = new Set(popularPapers.map(p => p.uid || ''));
                    const additionalPapers = recentForPopular.filter(p => !existingIds.has(p.uid || ''));
                    popularPapers = [...popularPapers, ...additionalPapers].slice(0, 10);
                }
                
                // ìµœì‹  ë…¼ë¬¸ ì •ë ¬ (ë‚ ì§œ ê¸°ì¤€, ìµœì‹ ìˆœ, ë¯¸ë˜ ë‚ ì§œ í¬í•¨)
                const recentPapers = [...papers]
                    .filter(paper => {
                        // ìµœê·¼ 2ë…„ ë‚´ ë…¼ë¬¸ë§Œ (ê³¼ê±° ë…¼ë¬¸ ì œì™¸)
                        const pubDate = paper.pubdate || paper.sortpubdate || paper.epubdate || '';
                        if (!pubDate) return false;
                        
                        const paperDate = parsePaperDate(pubDate);
                        if (!paperDate) return false;
                        
                        // 2ë…„ ì „ë¶€í„° ë¯¸ë˜ê¹Œì§€ í¬í•¨
                        const twoYearsAgoDate = new Date();
                        twoYearsAgoDate.setFullYear(twoYearsAgoDate.getFullYear() - 2);
                        
                        return paperDate >= twoYearsAgoDate;
                    })
                    .sort((a, b) => {
                        const dateA = a.pubdate || a.sortpubdate || a.epubdate || '';
                        const dateB = b.pubdate || b.sortpubdate || b.epubdate || '';
                        if (!dateA && !dateB) return 0;
                        if (!dateA) return 1;
                        if (!dateB) return -1;
                        
                        // ë‚ ì§œ íŒŒì‹±í•˜ì—¬ ë¹„êµ
                        const dateAObj = parsePaperDate(dateA);
                        const dateBObj = parsePaperDate(dateB);
                        
                        if (!dateAObj && !dateBObj) return 0;
                        if (!dateAObj) return 1;
                        if (!dateBObj) return -1;
                        
                        // ìµœì‹ ìˆœ (ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ)
                        return dateBObj - dateAObj;
                    })
                    .slice(0, 10);

                // ë…¼ë¬¸ ì¹´ë“œ ìƒì„± í•¨ìˆ˜
                const createPaperCard = (paper) => {
                    const title = paper.title || 'ì œëª© ì—†ìŒ';
                    const authors = paper.authors ? paper.authors.map(a => a.name || '').filter(n => n).join(', ') : 'ì €ì ì •ë³´ ì—†ìŒ';
                    const journal = paper.source || '';
                    
                    // ë‚ ì§œ ì •ë³´ ì¶”ì¶œ (ì—¬ëŸ¬ í•„ë“œ í™•ì¸)
                    let pubDate = paper.pubdate || paper.sortpubdate || paper.epubdate || '';
                    let date = 'ë‚ ì§œ ì •ë³´ ì—†ìŒ';
                    let year = '';
                    
                    if (pubDate) {
                        // PubMed ë‚ ì§œ í˜•ì‹: "2024 Jan 15" ë˜ëŠ” "2024/01/15" ë˜ëŠ” "2024"
                        if (pubDate.includes(' ')) {
                            // "2024 Jan 15" í˜•ì‹
                            const parts = pubDate.split(' ');
                            year = parts[0] || '';
                            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                            const month = parts[1] ? (monthNames.indexOf(parts[1]) + 1) : '';
                            const day = parts[2] || '';
                            if (year && month && day) {
                                date = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                            } else if (year && month) {
                                date = `${year}-${String(month).padStart(2, '0')}`;
                            } else if (year) {
                                date = year;
                            }
                        } else if (pubDate.includes('/')) {
                            // "2024/01/15" í˜•ì‹
                            const parts = pubDate.split('/');
                            year = parts[0] || '';
                            date = pubDate;
                        } else if (pubDate.length === 4) {
                            // "2024" í˜•ì‹
                            year = pubDate;
                            date = year;
                        } else {
                            date = pubDate;
                            year = pubDate.substring(0, 4);
                        }
                    }
                    
                    const pmid = paper.uid || '';
                    const pmidUrl = pmid ? `https://pubmed.ncbi.nlm.nih.gov/${pmid}/` : '';
                    const abstract = paper.abstract || '';
                    const citationCount = paper.citationCount || 0;
                    
                    // ìµœì‹  ë…¼ë¬¸ í‘œì‹œ (1ë…„ ì´ë‚´)
                    let dateBadge = '';
                    if (year) {
                        const paperYear = parseInt(year);
                        const currentYear = new Date().getFullYear();
                        if (paperYear === currentYear || paperYear === currentYear - 1) {
                            dateBadge = '<span style="background: #4caf50; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.75em; margin-left: 8px;">ìµœì‹ </span>';
                        }
                    }

                    return `
                        <div class="paper-card">
                            <h3>${escapeHtml(title)}${dateBadge}</h3>
                            <div class="authors">${escapeHtml(authors)}</div>
                            ${journal ? `<div class="journal">ğŸ“– ${escapeHtml(journal)}</div>` : ''}
                            <div class="date">ğŸ“… ${date}${citationCount > 0 ? ` | ì¸ìš©: ${citationCount}íšŒ` : ''}</div>
                            ${abstract ? `<div class="abstract" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e0e0e0;">${escapeHtml(abstract.substring(0, 200))}${abstract.length > 200 ? '...' : ''}</div>` : ''}
                            ${pmidUrl ? `<div style="margin-top: 10px;"><a href="${pmidUrl}" target="_blank">ë…¼ë¬¸ ë³´ê¸° (PubMed)</a></div>` : ''}
                        </div>
                    `;
                };

                // ì¸ê¸° ë…¼ë¬¸ ëª©ë¡ í‘œì‹œ (ì§€ë‚œ 5ë…„ ë‚´, ì¸ìš© ìˆ˜ ë†’ì€ ìˆœ)
                if (popularPapers.length > 0) {
                    popularPapersList.innerHTML = popularPapers.map(createPaperCard).join('');
                } else {
                    // ìµœí›„ì˜ ìˆ˜ë‹¨: ìµœì‹  ë…¼ë¬¸ ì¤‘ ì¼ë¶€ë¥¼ ì¸ê¸° ë…¼ë¬¸ìœ¼ë¡œ í‘œì‹œ
                    const fallbackPapers = [...papers]
                        .filter(p => {
                            const pubDate = p.pubdate || p.sortpubdate || p.epubdate || '';
                            if (!pubDate) return false;
                            let paperYear = null;
                            if (pubDate.includes(' ')) {
                                paperYear = parseInt(pubDate.split(' ')[0]);
                            } else if (pubDate.includes('/')) {
                                paperYear = parseInt(pubDate.split('/')[0]);
                            } else if (pubDate.length === 4) {
                                paperYear = parseInt(pubDate);
                            }
                            return paperYear && paperYear >= fiveYearsAgo && paperYear <= currentYear + 1;
                        })
                        .sort((a, b) => {
                            // ìµœì‹ ìˆœ
                            const dateA = a.pubdate || a.sortpubdate || a.epubdate || '';
                            const dateB = b.pubdate || b.sortpubdate || b.epubdate || '';
                            return dateB.localeCompare(dateA);
                        })
                        .slice(0, 10);
                    
                    if (fallbackPapers.length > 0) {
                        popularPapersList.innerHTML = `
                            <div style="padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 20px;">
                                <p style="color: #856404; font-size: 0.9em; margin: 0;">
                                    ğŸ’¡ ì¸ìš© ìˆ˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì–´ ìµœì‹  ë…¼ë¬¸ì„ ì¸ê¸° ë…¼ë¬¸ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
                                </p>
                            </div>
                            ${fallbackPapers.map(createPaperCard).join('')}
                        `;
                    } else {
                        popularPapersList.innerHTML = `
                            <div class="empty-state">
                                <p>ì§€ë‚œ 5ë…„ ë‚´ ì¸ê¸° ë…¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                <p style="margin-top: 10px; font-size: 0.9em;">ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</p>
                            </div>
                        `;
                    }
                }

                // ìµœì‹  ë…¼ë¬¸ ëª©ë¡ í‘œì‹œ
                if (recentPapers.length > 0) {
                    recentPapersList.innerHTML = recentPapers.map(createPaperCard).join('');
                } else {
                    recentPapersList.innerHTML = `
                        <div class="empty-state">
                            <p>ìµœì‹  ë…¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    `;
                }

                // í˜„ì¬ ê²€ìƒ‰ëœ ë…¼ë¬¸ ID ëª©ë¡
                const currentPaperIds = papers.map(p => p.uid || '').filter(id => id);
                
                // ìƒˆë¡œìš´ ë…¼ë¬¸ ì°¾ê¸° (ì´ì „ ê²€ìƒ‰ì— ì—†ë˜ ë…¼ë¬¸)
                const newPaperIds = currentPaperIds.filter(id => !lastPaperIds.includes(id));
                const newPapers = papers.filter(p => newPaperIds.includes(p.uid || ''));
                
                // ì €ì¥ëœ ë…¼ë¬¸ ì—…ë°ì´íŠ¸
                savedPapers = papers.map(paper => {
                    const pubDate = paper.pubdate || paper.sortpubdate || paper.epubdate || '';
                    let formattedDate = '';
                    
                    if (pubDate) {
                        if (pubDate.includes(' ')) {
                            const parts = pubDate.split(' ');
                            const year = parts[0] || '';
                            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                            const month = parts[1] ? (monthNames.indexOf(parts[1]) + 1) : '';
                            const day = parts[2] || '';
                            if (year && month && day) {
                                formattedDate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                            } else if (year && month) {
                                formattedDate = `${year}-${String(month).padStart(2, '0')}`;
                            } else {
                                formattedDate = year || pubDate;
                            }
                        } else {
                            formattedDate = pubDate;
                        }
                    }
                    
                    return {
                        id: paper.uid || Date.now().toString(),
                        title: paper.title || '',
                        authors: paper.authors ? paper.authors.map(a => a.name || '').filter(n => n).join(', ') : '',
                        journal: paper.source || '',
                        date: formattedDate || pubDate || '',
                        doi: '',
                        pmid: paper.uid || '',
                        savedAt: new Date().toISOString()
                    };
                });
                
                // ë§ˆì§€ë§‰ ê²€ìƒ‰ ì‹œê°„ ë° ë…¼ë¬¸ ID ì €ì¥
                lastSearchTime = new Date().toISOString();
                lastPaperIds = currentPaperIds;
                localStorage.setItem('savedPapers', JSON.stringify(savedPapers));
                localStorage.setItem('lastSearchTime', lastSearchTime);
                localStorage.setItem('lastPaperIds', JSON.stringify(lastPaperIds));
                
                updateStats();
                updateLastSearchTime();
                
                // ìƒˆë¡œìš´ ë…¼ë¬¸ì´ ìˆìœ¼ë©´ ì•Œë¦¼ í‘œì‹œ
                if (newPapers.length > 0 && (isAutoUpdate || lastPaperIds.length > 0)) {
                    showNewPapersAlert(newPapers);
                }

            } catch (error) {
                console.error('Error:', error);
                if (error.name === 'AbortError') {
                    papersList.innerHTML = `
                        <div class="empty-state">
                            <p>ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                            <p style="margin-top: 10px; font-size: 0.9em;">ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    `;
                } else {
                    papersList.innerHTML = `
                        <div class="empty-state">
                            <p>ë…¼ë¬¸ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                            <p style="margin-top: 10px; font-size: 0.9em;">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    `;
                }
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('alertCount').textContent = alerts.length;
            // ì €ì¥ëœ ë…¼ë¬¸ ìˆ˜ëŠ” ì‹¤ì œ ê²€ìƒ‰ëœ ë…¼ë¬¸ ìˆ˜ë¡œ í‘œì‹œ (ê³ ì •ëœ 10ê°œê°€ ì•„ë‹˜)
            const uniquePapers = [...new Map(savedPapers.map(p => [p.id, p])).values()];
            document.getElementById('paperCount').textContent = uniquePapers.length;
        }

        // ì¸ìš© ìˆ˜ ê¸°ì¤€ ì•Œë¦¼ ì²´í¬
        function checkCitationAlerts(papers) {
            if (alerts.length === 0) return;
            
            alerts.forEach(alert => {
                if (!alert.minCitations || alert.minCitations <= 0) return;
                
                // í•´ë‹¹ ì•Œë¦¼ì˜ í‚¤ì›Œë“œì™€ ì¼ì¹˜í•˜ê³ , ì¸ìš© ìˆ˜ ê¸°ì¤€ì„ ë§Œì¡±í•˜ëŠ” ë…¼ë¬¸ ì°¾ê¸°
                const matchingPapers = papers.filter(paper => {
                    // í‚¤ì›Œë“œ ë§¤ì¹­
                    const title = (paper.title || '').toLowerCase();
                    const matchesKeyword = alert.keywords.some(keyword => 
                        title.includes(keyword.toLowerCase())
                    );
                    
                    if (!matchesKeyword) return false;
                    
                    // ì¸ìš© ìˆ˜ ê¸°ì¤€ í™•ì¸
                    const citationCount = paper.citationCount || 0;
                    return citationCount >= alert.minCitations;
                });
                
                // ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë…¼ë¬¸ì´ ìˆìœ¼ë©´ ì•Œë¦¼
                if (matchingPapers.length > 0) {
                    const paperTitles = matchingPapers.slice(0, 3).map(p => p.title || 'ì œëª© ì—†ìŒ').join(', ');
                    const moreCount = matchingPapers.length > 3 ? ` ì™¸ ${matchingPapers.length - 3}ê°œ` : '';
                    
                    // ë¸Œë¼ìš°ì € ì•Œë¦¼ (ì‚¬ìš©ìê°€ í—ˆìš©í•œ ê²½ìš°)
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification('ğŸ“š ì¸ìš© ìˆ˜ ê¸°ì¤€ ë…¼ë¬¸ ë°œê²¬!', {
                            body: `${matchingPapers.length}ê°œì˜ ë…¼ë¬¸ì´ ì¸ìš© ìˆ˜ ${alert.minCitations}íšŒ ì´ìƒì…ë‹ˆë‹¤.`,
                            icon: 'ğŸ“š'
                        });
                    } else if (Notification.permission !== 'denied') {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                new Notification('ğŸ“š ì¸ìš© ìˆ˜ ê¸°ì¤€ ë…¼ë¬¸ ë°œê²¬!', {
                                    body: `${matchingPapers.length}ê°œì˜ ë…¼ë¬¸ì´ ì¸ìš© ìˆ˜ ${alert.minCitations}íšŒ ì´ìƒì…ë‹ˆë‹¤.`,
                                    icon: 'ğŸ“š'
                                });
                            }
                        });
                    }
                    
                    // í˜ì´ì§€ ë‚´ ì•Œë¦¼ í‘œì‹œ
                    showCitationAlert(matchingPapers.length, alert.minCitations, paperTitles + moreCount);
                }
            });
        }
        
        // ì¸ìš© ìˆ˜ ì•Œë¦¼ í‘œì‹œ
        function showCitationAlert(count, minCitations, titles) {
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 400px;
                animation: slideIn 0.3s ease-out;
            `;
            alertDiv.innerHTML = `
                <h3 style="margin-bottom: 10px;">ğŸ“š ì¸ìš© ìˆ˜ ê¸°ì¤€ ë…¼ë¬¸ ë°œê²¬!</h3>
                <p style="margin-bottom: 5px;">${count}ê°œì˜ ë…¼ë¬¸ì´ ì¸ìš© ìˆ˜ ${minCitations}íšŒ ì´ìƒì…ë‹ˆë‹¤.</p>
                <p style="font-size: 0.9em; opacity: 0.9;">${titles}</p>
                <button onclick="this.parentElement.remove()" style="margin-top: 10px; padding: 5px 15px; background: white; color: #667eea; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">ë‹«ê¸°</button>
            `;
            document.body.appendChild(alertDiv);
            
            // 10ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 10000);
        }

        // ìƒˆë¡œìš´ ë…¼ë¬¸ ì•Œë¦¼ í‘œì‹œ
        function showNewPapersAlert(newPapers) {
            const count = newPapers.length;
            const titles = newPapers.slice(0, 3).map(p => p.title || 'ì œëª© ì—†ìŒ').join(', ');
            const moreCount = newPapers.length > 3 ? ` ì™¸ ${newPapers.length - 3}ê°œ` : '';
            
            // ë¸Œë¼ìš°ì € ì•Œë¦¼
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('ğŸ†• ìƒˆë¡œìš´ ë…¼ë¬¸ ë°œê²¬!', {
                    body: `${count}ê°œì˜ ìƒˆë¡œìš´ ë…¼ë¬¸ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.`,
                    icon: 'ğŸ“š'
                });
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification('ğŸ†• ìƒˆë¡œìš´ ë…¼ë¬¸ ë°œê²¬!', {
                            body: `${count}ê°œì˜ ìƒˆë¡œìš´ ë…¼ë¬¸ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.`,
                            icon: 'ğŸ“š'
                        });
                    }
                });
            }
            
            // í˜ì´ì§€ ë‚´ ì•Œë¦¼ í‘œì‹œ
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
                color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 400px;
                animation: slideIn 0.3s ease-out;
            `;
            alertDiv.innerHTML = `
                <h3 style="margin-bottom: 10px;">ğŸ†• ìƒˆë¡œìš´ ë…¼ë¬¸ ë°œê²¬!</h3>
                <p style="margin-bottom: 5px;">${count}ê°œì˜ ìƒˆë¡œìš´ ë…¼ë¬¸ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                <p style="font-size: 0.9em; opacity: 0.9;">${escapeHtml(titles)}${moreCount}</p>
                <button onclick="this.parentElement.remove()" style="margin-top: 10px; padding: 5px 15px; background: white; color: #4caf50; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">ë‹«ê¸°</button>
            `;
            document.body.appendChild(alertDiv);
            
            // 15ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 15000);
        }

        // XSS ë°©ì§€
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ì´ˆê¸° ë¡œë“œ
        loadData();
    </script>
</body>
</html>

